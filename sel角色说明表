ğŸ“¦ ä¸€ã€Supabase æ•°æ®åº“å»ºè¡¨ SQL
1ï¸âƒ£ ä¸“å®¶ä»»åŠ¡è°ƒåº¦è¡¨ï¼ˆagent_tasksï¼‰
sql
å¤åˆ¶
ç¼–è¾‘
CREATE TABLE agent_tasks (
    task_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    agent_role TEXT NOT NULL,
    prompt TEXT NOT NULL,
    priority TEXT DEFAULT 'ä¸­',
    assigned_at TIMESTAMP DEFAULT timezone('utc', now()),
    status TEXT DEFAULT 'å¾…å¤„ç†',
    result TEXT,
    completed_at TIMESTAMP
);
2ï¸âƒ£ ç”¨æˆ·åé¦ˆè¯„åˆ†è¡¨ï¼ˆfeedback_scoresï¼‰
sql
å¤åˆ¶
ç¼–è¾‘
CREATE TABLE feedback_scores (
    feedback_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id TEXT NOT NULL,
    scene TEXT,
    selected_text TEXT,
    style TEXT,
    score INT CHECK (score BETWEEN 1 AND 5),
    reason TEXT,
    selected_at TIMESTAMP DEFAULT timezone('utc', now())
);
ğŸ“š äºŒã€FastAPI API æ¥å£å®ç°
ğŸ“„ backend/agent_task_api.py
python
å¤åˆ¶
ç¼–è¾‘
from fastapi import APIRouter
from pydantic import BaseModel
from supabase import create_client
import os
from dotenv import load_dotenv
import uuid
from datetime import datetime

load_dotenv()

supabase_url = os.getenv("SUPABASE_URL")
supabase_key = os.getenv("SUPABASE_KEY")

supabase = create_client(supabase_url, supabase_key)
router = APIRouter()

class TaskModel(BaseModel):
    agent_role: str
    prompt: str
    priority: str = "ä¸­"

@router.post("/assign")
async def assign_task(task: TaskModel):
    data = task.dict()
    data["task_id"] = str(uuid.uuid4())
    data["assigned_at"] = datetime.utcnow().isoformat()
    data["status"] = "å¾…å¤„ç†"
    response = supabase.table("agent_tasks").insert(data).execute()
    return {"status": "success", "data": response.data}

@router.get("/list")
async def get_all_tasks():
    response = supabase.table("agent_tasks").select("*").execute()
    return {"tasks": response.data}
ğŸ“„ main.py æ³¨å†Œ API è·¯ç”±
python
å¤åˆ¶
ç¼–è¾‘
from agent_task_api import router as agent_task_router

app.include_router(agent_task_router, prefix="/api/agent", tags=["Agent Tasks"])
ğŸ“… ä¸‰ã€ç¤ºèŒƒ API è°ƒç”¨
bash
å¤åˆ¶
ç¼–è¾‘
curl -X POST "http://localhost:8000/api/agent/assign" \
-H "accept: application/json" \
-H "Content-Type: application/json" \
-d '{
  "agent_role": "éœ€æ±‚åˆ†æå®˜",
  "prompt": "ç”¨æˆ·å¸Œæœ›å¼€å‘ä¸€ä¸ªé«˜æƒ…å•†èŠå¤©åŠ©æ‰‹APPï¼Œå…·å¤‡æ™ºèƒ½æ¨èå’Œç”¨æˆ·æˆé•¿åŠŸèƒ½ã€‚",
  "priority": "é«˜"
}'
ğŸ“¢ æœ€ç»ˆç›®æ ‡ï¼š

å®ç°ä»»åŠ¡è‡ªåŠ¨åˆ†é…ä¸è®°å½•ã€‚

å¯ä»¥åœ¨å‰ç«¯ç®¡ç†ç•Œé¢ç›´æ¥æŸ¥çœ‹ä»»åŠ¡åˆ†é…çŠ¶æ€å’Œç»“æœï¼ˆAgent Dashboardï¼‰ã€‚

æ‰€æœ‰å†å²ä»»åŠ¡ã€åé¦ˆã€è¯„åˆ†éƒ½å¯è¿½è¸ªã€‚

